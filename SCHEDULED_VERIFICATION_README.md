# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

## –û–ø–∏—Å–∞–Ω–∏–µ

–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ –≤—Å–µ—Ö —á–∞—Ç–∞—Ö –∏–ª–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —á–∞—Ç–µ –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚è∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
- üîÑ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ—Ç 1 –¥–æ 168 —á–∞—Å–æ–≤)
- üì± –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —á–∞—Ç—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéõÔ∏è –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
- üìä –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –∏ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã:

```bash
cd backend
python create_schedule_table.py
```

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –Ω–∞–ø—Ä—è–º—É—é –≤ –≤–∞—à–µ–π –ë–î:

```sql
CREATE TABLE user_verification_schedule (
    id INT NOT NULL AUTO_INCREMENT,
    enabled BOOLEAN NOT NULL DEFAULT FALSE,
    schedule_time TIME NOT NULL,
    interval_hours INT NOT NULL DEFAULT 24,
    auto_update BOOLEAN NOT NULL DEFAULT TRUE,
    chat_id INT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_run_at DATETIME NULL,
    next_run_at DATETIME NULL,
    PRIMARY KEY (id),
    INDEX ix_user_verification_schedule_id (id),
    FOREIGN KEY (chat_id) REFERENCES chats(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

```bash
cd backend
uvicorn app.main:app --reload
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ —Å–µ–∫—Ü–∏–∏ "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
3. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞**: –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 02:00)
   - **–ò–Ω—Ç–µ—Ä–≤–∞–ª (—á–∞—Å–æ–≤)**: –∫–∞–∫ —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å (24 = –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
   - **–§–∏–ª—å—Ç—Ä –ø–æ —á–∞—Ç—É**: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π
   - **–í–∫–ª—é—á–µ–Ω–æ**: –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–∞–∑—É
   - **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
```
GET /api/v1/admin/verification-schedule/schedules
```

#### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
```
POST /api/v1/admin/verification-schedule/schedules
Content-Type: application/json

{
  "enabled": true,
  "schedule_time": "02:00:00",
  "interval_hours": 24,
  "auto_update": true,
  "chat_id": null
}
```

#### –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
```
PUT /api/v1/admin/verification-schedule/schedules/{schedule_id}
Content-Type: application/json

{
  "enabled": false
}
```

#### –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
```
POST /api/v1/admin/verification-schedule/schedules/{schedule_id}/toggle
```

#### –£–¥–∞–ª–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
```
DELETE /api/v1/admin/verification-schedule/schedules/{schedule_id}
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞**: –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `scheduled_user_verification()`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É, –µ—Å—Ç—å –ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π**: –ó–∞–¥–∞—á–∞ –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, —É –∫–æ—Ç–æ—Ä—ã—Ö `next_run_at` <= —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (chat_id, auto_update).

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏**: –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è `last_run_at` –∏ `next_run_at` –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –≤ 2 —á–∞—Å–∞ –Ω–æ—á–∏
- –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: `02:00`
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: `24` —á–∞—Å–∞
- –§–∏–ª—å—Ç—Ä –ø–æ —á–∞—Ç—É: –Ω–µ –≤—ã–±—Ä–∞–Ω

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
- –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: `00:00`
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: `12` —á–∞—Å–æ–≤
- –§–∏–ª—å—Ç—Ä –ø–æ —á–∞—Ç—É: –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —á–∞—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
- –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: `03:00`
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: `168` —á–∞—Å–æ–≤ (7 –¥–Ω–µ–π)
- –§–∏–ª—å—Ç—Ä –ø–æ —á–∞—Ç—É: –Ω–µ –≤—ã–±—Ä–∞–Ω

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å:
- `Found X verification schedule(s) to run` - –Ω–∞–π–¥–µ–Ω—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `Running verification schedule {id}` - –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `Verification schedule {id} completed: X checked, Y updated, Z errors` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–µ–ª–∏
- `UserVerificationSchedule` - –º–æ–¥–µ–ª—å –ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
- –°–≤—è–∑—å —Å `Chat` —á–µ—Ä–µ–∑ `chat_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –°–µ—Ä–≤–∏—Å—ã
- `VerificationScheduleService` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏ (CRUD)
- `UserVerificationService` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –†–æ—É—Ç–µ—Ä—ã
- `/api/v1/admin/verification-schedule/*` - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏
- `/api/v1/admin/user-verification/*` - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## Troubleshooting

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (`enabled = true`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `create_schedule_table.py` –∏–ª–∏ SQL –∑–∞–ø—Ä–æ—Å –≤—Ä—É—á–Ω—É—é

### –û—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
- –ë–æ—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç–∞–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5 —Å–µ–∫)
